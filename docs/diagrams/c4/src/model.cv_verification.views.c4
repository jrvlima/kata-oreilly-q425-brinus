

views {
    dynamic view cv_return_photo_verification {
        title 'Dynamic / CV / Return photo verification via events + LLM'
        description '202 Accepted UX → preprocess → LLM decision → booking state → optional human override'

        mobiltiy_corp.applications.customer_app
            -> mobiltiy_corp.microservices.photo_service.photo_controller
            'POST /photos (202; correlation_id)'

        mobiltiy_corp.microservices.photo_service.photo_controller
            -> mobiltiy_corp.platform.message_broker.queues.topic_cv_photostored
            'Publish PhotoStored (URIs only)'

        mobiltiy_corp.platform.stream_processor.cv_preprocessing
            <- mobiltiy_corp.platform.message_broker.queues.topic_cv_photostored
            'Consume'
        mobiltiy_corp.platform.stream_processor.cv_preprocessing
            -> mobiltiy_corp.platform.data_layers.object_store_bronze
            'Write silver artifact'
        mobiltiy_corp.platform.stream_processor.cv_preprocessing
            -> mobiltiy_corp.platform.message_broker.queues.topic_cv_preprocessed
            'Publish PhotoPreprocessed'

        mobiltiy_corp.platform.stream_processor.cv_orchestrator
            <- mobiltiy_corp.platform.message_broker.queues.topic_cv_preprocessed
            'Consume'
        mobiltiy_corp.platform.stream_processor.cv_orchestrator
            -> mobiltiy_corp.ai_systems.rag_api.cv_decision_endpoint
            'Request decision (temp=0; JSON)'
        mobiltiy_corp.platform.stream_processor.cv_orchestrator
            -> mobiltiy_corp.platform.message_broker.queues.topic_cv_decision
            'Publish CVDecision'

        mobiltiy_corp.microservices.booking_service
            <- mobiltiy_corp.platform.message_broker.queues.topic_cv_decision
            'Associate + advance state'
        }    
}

